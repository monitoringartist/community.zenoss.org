<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>
        Extending Net-SNMP to Allow ZenOSS to Monitor Postfix - Open Source Network Monitoring and Systems Management
        
        
    </title>

    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /> 


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en-US" />
<meta name="keywords" content=""/>
<!-- Extending Net-SNMP to Allow ZenOSS to Monitor Postfix -->
<meta property="og:image" content="servlet/JiveServlet/downloadImage/73-2574-13230/share-zenoss-logo.jpg" />

<link rel="search"
    href="../opensearch.xml"
    title="Zenoss Community"
    type="application/opensearchdescription+xml"/>


<link rel="shortcut icon" href="../themes/userbar-disabled/images/favicon.ico" />

    





    
      
      
     




    



    
    





    <link rel="stylesheet" href="../styles/jive-global.css" type="text/css" media="all" />
    <!-- <link rel="stylesheet" href="/styles/jive-icons-legacy.css" type="text/css" media="all" /> -->
    <link rel="stylesheet" href="../styles/jive-icons.css" type="text/css" media="all" />

    <link rel="stylesheet" href="../themes/userbar-disabled/styles/theme.css" type="text/css" media="all" />
    <link rel="stylesheet" href="../themes/userbar-disabled/styles/community.css" type="text/css" media="all" />
    <link rel="stylesheet" href="../themes/userbar-disabled/styles/sifr.css" type="text/css" media="all" />


    <!--[if IE 6]>
    <style type="text/css">
    /* hack for IE6's lack of alpha PNG support */
    * html #jive-wrapper .ie6png,
    * html #jive-wrapper #jive-global-header *.ie6png,
    * html #jive-wrapper #user-bar-wrapper *.ie6png,
    * html #jive-wrapper #jive-body *.ie6png,
    * html #jive-wrapper #jive-footer *.ie6png {
        background-image: expression(
        this.runtimeStyle.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src=" +
        (this.tagName=='IMG' ? this.src : this.currentStyle.backgroundImage.split('\"')[1]) + ")",
        this.runtimeStyle.backgroundImage = "none",
        this.src = "/images/transparent.png"
        );
        }
    </style>

    <link rel="stylesheet" href="/styles/jive-icons-ie.css" type="text/css" media="all" />
    <![endif]-->





    
    

	<link rel="stylesheet" href="../4.5.6/styles/jive-content.css" type="text/css" media="all" />

        <link rel="alternate" type="application/rss+xml"
            title="Extending Net-SNMP to Allow ZenOSS to Monitor Postfix Version History Feed"
            href="../community/feeds/document-history/DOC-2477" />

        <link rel="alternate" type="application/rss+xml"
            title="Extending Net-SNMP to Allow ZenOSS to Monitor Postfix Comments Feed"
            href="../community/feeds/document-comments/DOC-2477" />

    
        




    <!-- BEGIN action bar, only for non-binary documents -->

    

    <!-- END action bar -->




    <style type="text/css">/* Rating bar on documents */
.jive-content .jive-content-header .jive-content-rating {margin-bottom: 3px;}
.j-rating { padding: 0 10px; }
.jive-content-avgrating {height: 53px;}
/* END Rating bar on documents */

/* Userbar */
#jive-userbar-right {right: 50px;}
/* END Userbar */

/* Download links page */
table.download-links-table {background-color: #ffffff; width: 100%;}
table.download-links-table tbody td { text-align: center; vertical-align: middle;}
table.download-links-table thead th {text-align: center;}
table.download-links-table td, table.download-links-table th {border: 1px solid #EEEEEE !important;}

/* Provides indentation for official doc ToC items */
div.toc dl dt {margin-left: 20px;}
div.toc dl dd dl dt {margin-left: 40px;}
div.toc dl dd dl dd dl dt {margin-left: 60px;}
div.toc dl dd dl dd dl dd dl dt {margin-left: 80px;}
div.toc dl dd dl dd dl dd dl dd dl dt {margin-left: 100px;}
/* END docs items */


/* Blog posts */
div.social-button-spacer {height: 10px;}

div#social-button-cont {
margin-right:10px; 
padding:5px; 
text-align: center; 
float: right;
}

div#comment-indicator {
    float: left;
    left: 12px;
    right: inherit;
    top: 55px;
}

div#comment-indicator div.jive-reply {margin-left: 0px;}

.jive-blog-post-subject {padding-bottom: 0px;}
/* END Blog posts */


/* Community download survey */
form#core-usage-survey label.aligned {float: left; width: 120px;}
form#core-usage-survey span.required_field {color: red;}
form#core-usage-survey label.survey-small-label {display:inline;}
form#core-usage-survey div.survey-checkbox-set {width:82%;}
form#core-usage-survey div.border {border:1px solid #ACACAC; padding:5px;}

form#core-usage-survey label.survey-resource_type {font-style:italic;}
form#core-usage-survey label {
color:#333333;
display:block;
font-size:12px;
font-weight:bold;
}
/* END Community download survey */

</style>
    <style type="text/css">/* custom-css-container */</style>


</head>
<body class="jive-body-home" ><div style="width:100%;background-color:white;float:left;position:fixed;z-index:3000;top:0;right:0;border-bottom:2px solid gray;"><div style="width:1006px;font-weight:bold;margin:12px auto 12px auto;font-size:18px;"><div style="float: left; margin: 0;">Archived community.zenoss.org | full text search <form style="display: inline;" target="_blank" action="https://github.com/monitoringartist/community.zenoss.org/search" method="get"><input type="text" name="q"><input type="submit" value="Search"></form> </div><div style="float: right;"><a href="https://www.monitoringartist.com" title="Maintained by Monitoring Artist - DevOps / Docker / Kubernetes / Zabbix / Zenoss / Monitoring"><img src="/community.zenoss.org/assests-monitoringartist/Monitoring-Artist-logo.png" /></a></div></div></div>


<a href="DOC-2477.html#jive-body" class="jive-skip-nav">Skip navigation</a>

    <div id="jive-compliance" class=""style="display:none">
        <span class="jive-icon-med "></span>
        
    </div>

    <div id="jive-wrapper" class="clearfix">

    <!-- Load search for guests -->

    <div id="jive-userbar-search">
    <form action="search.jspa" method="get" id="jive-userbar-search-form">
        <input type="hidden" name="peopleEnabled" value="true"/>

        <input type="hidden" name="userID"/>
        <input type="hidden" name="containerType"/>
        <input type="hidden" name="container"/>
        <input type="hidden" name="spotlight" value="false"/>
        <label for="jive-query"
               class="j-508-label">Search for:</label>
        <input type="text" id="jive-query" name="q" value="" accesskey="4" class="searchbar jive-userbar-search-field"
               autocomplete="off"/>
    </form>

    <div id="jive-spotlight-search-container"></div>
</div>

    <!-- END anon search -->

<!-- SKIP NAV FOR ACCESSIBILITY -->
<a href="DOC-2477.html#skipnav"></a>
<!-- END -->

<div id="header">

    <!-- START TOP NAVIGATION -->
    <div id="navcontainer">
        <table cellpadding="0" cellspacing="0" width="100%" border="0">
          <tr valign="bottom">
            <td rowspan="2">
                <a href="../index.html" title="Zenoss Open Source IT Management"><img src="../themes/userbar-disabled/images/zenoss-logo-reversed-web.png" style="width:254px; margin: 0 0px 25px;" alt="Zenoss Open Enterprise Management" /></a>
            </td>
            <td height="45" colspan="2">
                <div id="zenoss-panel">
                    <div style="width: 200px;" id="cpanel-lt"></div>
                    <ul id="subnav-rt" class="png_fix">
                        <li><a href="http://www.zenoss.com/" title="Zenoss.Inc Home" class="none">Zenoss, Inc.</a></li>
                        <!--<li><a href="/community/feedback" title="Feedback" class="none">Feedback</a></li>-->
                        <!--<li><a href="http://www.zenoss.com/support" title="Support" class="none">Support</a></li>-->
                    </ul>
                </div>
            </td>
          </tr>
          <tr valign="middle">
            <td colspan="2" height="80">
                <ul id="navlist">
                    <li><a href="community/documentation" title="DOCS" class="nav1"><span>DOCS</span></a></li>
                    <li><a href="community/forums" title="FORUMS" class="nav2"><span>FORUMS</span></a></li>        
                    <!--<li><a href="/community/zenpacks" title="ZENPACKS" class="nav3"><span>ZENPACKS</span></a></li>-->
                    <li><a href="http://wiki.zenoss.org/Category:ZenPacks" title="ZENPACKS" class="nav3"><span>ZENPACKS</span></a></li>        
                    <li><a href="community/partners" title="PARTNERS" class="nav4"><span>PARTNERS</span></a></li>      
                    <li><a href="community/about" title="ABOUT" class="nav4"><span>ABOUT</span></a></li>   
                    <li><a href="../blogs/zenossblog.html" title="BLOG" class="nav5"><span>BLOG</span></a></li>
                    <li><a href="community/testing" title="TESTING" class="nav5"><span>TESTING</span></a></li> 
                    <li><a href="community/developers" title="DEVELOPERS" class="nav6"><span>DEVELOPMENT</span></a></li>
                    <li><a href="../community/download.html" title="DOWNLOADS" class="nav7 png_fix"><span>DOWNLOAD</span></a></li>
                </ul>
            </td>
          </tr>
        </table>
    </div>
    <!-- END TOP NAV -->

</div>

<!-- START MID COL -->
<div id="middle">

    <!-- SKIPNAV ADDED FOR ACCESSIBILITY -->
    <a name="skipnav"></a>
    <!-- SKIPNAV END -->
        
      <!-- START CONTENT -->
      
        <!-- MAIN CONTENT START -->
        <!-- CHANGE CLASS ACCORDING TO SUB SECTION FOR PROPER TOP BANNER -->


        <div id="subcontent">




<!-- BEGIN user bar -->
<div id="user-bar-wrapper">
    <div id="jive-userbar">
<div id="jive-userbar-login">
    <form action="https://community.zenoss.org/cs_login"
          method="post" name="loginform" autocomplete="off">
        
        

        <span class="jive-userbar-login-welcome" id="jiveLoginWelcome">
            <span class="jive-userbar-login-guest">
            Welcome, Guest
            </span>

            <span class="jive-userbar-login-loginlink">
                <a href="DOC-2477.html#" onClick="jivetoggleLogin(); return false;">Login</a>
            </span>

            <span class="jive-userbar-login-new">
                <a href="../login!input.jspa%3FregisterOnly=true.html">Register</a>
            </span>
        </span>

        <span class="jive-userbar-login-form" id="jiveLoginForm" style="display: none;">

            <span class="jive-userbar-login-username">
                <label for="login-username">
Username:                </label>
                <a href="docs/forgot-username!input.jspa" title="I forgot my username ">(?)</a>
                <input type="text" name="username" size="20" maxlength="150" value="" tabindex="1"
                               id="login-username" />
            </span>

            <span class="jive-userbar-login-password">
                <label for="login-password">
Password:                </label>
                <a href="docs/emailPasswordToken!input.jspa" title="I forgot my password ">(?)</a>
                <input type="password" name="password" size="20" maxlength="150" value="" tabindex="2"
                               id="login-password" />
            </span>

            <span class="jive-userbar-login-auto">
                <input type="checkbox" name="autoLogin" id="login-auto" value="true" tabindex="3" />
                <label for="login-auto">Remember Me</label>
            </span>

            <span class="jive-userbar-login-submit">
                <input type="submit" name="login" value="Login" tabindex="4"
                       class="jive-login-button" />
                <input type="reset" name="doCancel" value="Cancel" tabindex="5"
                               class="jive-cancel-button" onclick="jivetoggleLogin();" />
            </span>
        </span>

    </form>
</div>        <div id="jive-userbar-right">

    <div id="jive-userbar-search">
    <form action="search.jspa" method="get" id="jive-userbar-search-form">
        <input type="hidden" name="peopleEnabled" value="true"/>

        <input type="hidden" name="userID"/>
        <input type="hidden" name="containerType"/>
        <input type="hidden" name="container"/>
        <input type="hidden" name="spotlight" value="false"/>
        <label for="jive-query"
               class="j-508-label">Search for:</label>
        <input type="text" id="jive-query" name="q" value="" accesskey="4" class="searchbar jive-userbar-search-field"
               autocomplete="off"/>
    </form>

    <div id="jive-spotlight-search-container"></div>
</div>

        </div>
    </div>

</div>
<!-- END user bar -->

            <div id="jive-body">

<!-- BEGIN breadcrumb -->
<div id="jive-breadcrumb">

    <span>
                <a href="../index.jspa.html">
            Zenoss Community</a> &gt; 
                <a href="community/documentation">
            Documentation</a> &gt; 
                <a href="community/documentation/wiki">
            Wiki</a> &gt; 
                <a href="../community/documentation/wiki/configuration.html">
            Configuration</a> &gt; 

        <a class='jive-breadcrumb-last' href="../community/documentation/wiki/configuration%3Fview=documents.html">Documents</a></span>
</div>
<!-- END breadcrumb -->

            

    <form id="documentRestoreForm" method="post" action='docs/DOC-2477/restore'>
        <input type="hidden" name="version" value="2" />
        <input type="hidden" name="jive.token.name" value="document.restore.DOC-2477"/>
        <input type="hidden" name="document.restore.DOC-2477" value="1394830290260-3M5ED1WGZ7OEBB8YTYQ6RMYZE4J3YQ45"/>
    </form>

    <form id="documentDeleteForm" method="post" action='docs/DOC-2477/delete'>
        <input type="hidden" name="jive.token.name" value="document.delete.DOC-2477"/>
        <input type="hidden" name="document.delete.DOC-2477" value="1394830290266-6V1GFD33FP8VIMQLRX6H4WNO9H2QI6K4"/>
    </form>

    <form id="documentPublishForm" method="post" action='doc-publish.jspa'>
        <input type="hidden" name="jive.token.name" value="document.publish.DOC-2477"/>
        <input type="hidden" name="document.publish.DOC-2477" value="1394830290272-J7ZBBBZDZVR0MT607JMNVD4YG2LTEPGN"/>
        <input type="hidden" name="document" value="DOC-2477" />
    </form>


    <!-- BEGIN header & intro  -->
    <div id="jive-body-intro">
        <div id="jive-body-intro-content">
            
            <a href="../community/documentation/wiki/configuration%3Fview=documents.html"><span class="jive-icon-sml jive-icon-arrow-generic-up"></span>
                    Up to Documents in Configuration
            </a>

        </div>
    </div>
    <!-- END header & intro -->

    <!-- BEGIN main body -->
    <div id="jive-body-main">

        <!-- BEGIN main body column -->
        <div id="jive-body-maincol-container">

            <div id="jive-body-maincol">


                <div id="thread.watch.notify" class="jive-info-box" style="display:none"></div>

                <div id="content-featured-notify" class="jive-info-box" style="display:none"></div>








<!-- BEGIN document -->
<div class="jive-content clearfix">
    <div class="jive-content-header clearfix">
        <div class="jive-wiki-post-moderating jive-content-header-moderating">
            <span class="jive-icon-med jive-icon-moderation"></span>Currently Being Moderated
        </div>
        <div class="jive-content-title">
            <h2><span class="jive-icon-big jive-icon-document"></span>Extending Net-SNMP to Allow ZenOSS to Monitor Postfix</h2>
        </div>
        <div class="jive-content-header-version">
            VERSION 2&nbsp;
                <a href="docs/DOC-2477/diff?secondVersionNumber=2" title="Click to view document history"><img class="jive-icon-sml jive-icon-search" src="../4.5.6/images/transparent.png" alt="Click to view document history" /></a>


        </div>
        <div class="jive-content-header-details">

Created on: Sep 14, 2009 11:21 AM by
<a href="../people/nbrockett.html"
data-externalId=""
data-username="nbrockett"
data-avatarId="-1"
id="jive-692932881674369625048"
onmouseover="var presence = null; quickuserprofile.getUserProfileTooltip( 6929, presence );"
onmouseout="quickuserprofile.cancelTooltip();"
class="jiveTT-hover-user jive-username-link"
>Noel Brockett</a>            <span>-</span>
Last Modified:&nbsp;
Sep 14, 2009 3:10 PM
by <a href="../people/jhamilton.html"
data-externalId=""
data-username="jhamilton"
data-avatarId="1024"
id="jive-541932881674370231138"
onmouseover="var presence = null; quickuserprofile.getUserProfileTooltip( 5419, presence );"
onmouseout="quickuserprofile.cancelTooltip();"
class="jiveTT-hover-user jive-username-link"
>John Hamilton</a>        </div>

        <div class="jive-content-rating clearfix" data-guid="M0XM1XQNBRRQQJ38IXDVIOW7Z6YZEHYL">

<script type='text/javascript'>
    $j(document).ready(function() {

        var i18n = {
            avgUserRatingTitlei18n : "Average User Rating",
            avgUserRatingLabeli18n : "Average User Rating",
            rateRatingLabel : "rating",
            myRatingLabel : "My Rating:",
            rateRatingsLabel : "ratings",
            ratingSavingText : "Saving...",
            rateSavedText : "Saved.",
            rateRatingSaved : "Rating Saved!",
            writeAReview : "Write a review",
            commentOnRating : "Comment on your rating",
            formSubmitPleaseWait:'Please Wait ...'
        };

        new jive.Rate(14, 2143, 102, 2477, 'doc', i18n, true, 'M0XM1XQNBRRQQJ38IXDVIOW7Z6YZEHYL');
    });

</script>

        </div>
    </div>

    <div class="jive-content-body">


<!-- [DocumentBodyStart:881ef5f0-f988-4118-904a-2cabad597e43] --><div class="jive-rendered-content"><p>I have seen this question pop up several times on the lists and in IRC and thought that it may be useful for somebody to explain how I accomplish this in my own environment. Note that this may not be the most efficient way to accomplish this, but it does work (so far). This also gives you an idea of how to use net-snmp's "extend" functionality to pipe additional data and metrics through net-snmp. This type of setup can be used to monitor other stuff -- for example, BIND statistics.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p>For the purpose of this HOWTO, we are going to obtain 5 stats from Postfix:</p><ul><li>Messages Sent/5min</li><li>Messages Received/5min</li><li>Messages Rejected/5min</li><li>Messages Bounced/5min</li><li>Postfix Queue</li></ul><h2>Postfix Data Collection</h2><p>Because postfix does not not interface with SNMP, we need to gather the data using something else that runs locally on the Postfix server. We will use Craig Sander's Postfix MRTG scripts (<a class="jive-link-external-small" href="http://taz.net.au/postfix/mrtg/">http://taz.net.au/postfix/mrtg/</a>) as our basis.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p><em>update-mailstats.pl</em> is a daemon that will run on your Postfix server and collect data. Out of the box, this script only collects messages sent/received (local and remote) but we are going to extend it to collect bounced and rejected messages as well:</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><pre>use DB_File; use File::Tail ; $debug = 0;<br/><br/>$mail_log = '/var/log/maillog' ; $stats_file = '/mirror/etc/stats.db' ;<br/><br/>$db = tie(%stats, "DB_File", "$stats_file", O_CREAT|O_RDWR, 0666, $DB_HASH)<br/>&#160;&#160;&#160; || die ("Cannot open $stats_file");<br/><br/>#my $logref=tie(*LOG,"File::Tail",(name=&gt;$mail_log,tail=&gt;-1,debug=&gt;$debug)); my $logref=tie(*LOG,"File::Tail",(name=&gt;$mail_log,debug=&gt;$debug));<br/><br/>while () {<br/><br/>&#160;&#160;&#160; if (/status=sent/) {<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; next unless (/ postfix//) ; # count sent messages if (/relay=([^,]?+)/o) {<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; $relay = $1 ; #print "$relay..." ;<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; } ; if ($relay !~ /[/o ) {<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; $stats{"SENT:$relay"} += 1; #print "$relayn" ;<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; $stats{"SENT:smtp"} +=1 ; #print "smtpn" ;<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; } ; $db-&gt;sync;<br/>&#160;&#160;&#160; } elsif (/status=bounced/) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; # count bounced messages $stats{"BOUNCED:smtp"} += 1; $db-&gt;sync ;<br/>&#160;&#160;&#160; } elsif (/NOQUEUE: reject/) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; # count rejected messages $stats{"REJECTED:smtp"} += 1; $db-&gt;sync ;<br/>&#160;&#160;&#160; } elsif (/smtpd.*client=/) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; # count received smtp messages $stats{"RECEIVED:smtp"} += 1; $db-&gt;sync ;<br/>&#160;&#160;&#160; } elsif (/pickup.*(sender|uid)=/) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; # count received local messages $stats{"RECEIVED:local"} += 1; $db-&gt;sync ;<br/><br/>&#160;&#160;&#160; } ;<br/><br/>} ;<br/><br/>untie $logref ; untie %stats;</pre><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p>Make sure you have $mail_log set correctly, and start this daemon. It will create a database at $stats_file and start populating it as your maillog grows.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p>Now that we are collecting Postfix data, we need something to extract stats from the stats.db database which is being generated from update-mailstats.pl. Again, we will use Craig's mailstats.pl as our starting point and modify it a bit for our purpose:</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><pre>use DB_File;<br/><br/>$|=1;<br/><br/>$stats_file = '/mirror/etc/stats.db' ;<br/><br/>tie(%foo, "DB_File", "$stats_file", O_RDONLY, 0666, $DB_HASH) || die ("Cannot open $stats_file");<br/><br/>if ($ARGV[0]? =~ /sent/) {<br/><br/>&#160;&#160;&#160; foreach (sort keys %foo) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; print $foo{$_} if $_ =~ /SENT/;<br/><br/>&#160;&#160;&#160; }<br/><br/>} elsif ($ARGV[0]? =~ /received/) {<br/><br/>&#160;&#160;&#160; foreach (sort keys %foo) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; print $foo{$_} if $_ =~ /RECEIVED/;<br/><br/>&#160;&#160;&#160; }<br/><br/>} elsif ($ARGV[0]? =~ /bounced/) {<br/><br/>&#160;&#160;&#160; foreach (sort keys %foo) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; print $foo{$_} if $_ =~ /BOUNCED/;<br/><br/>&#160;&#160;&#160; }<br/><br/>} elsif ($ARGV[0]? =~ /rejected/) {<br/><br/>&#160;&#160;&#160; foreach (sort keys %foo) {<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160; print $foo{$_} if $_ =~ /REJECTED/;<br/><br/>&#160;&#160;&#160; }<br/><br/>} elsif ($ARGV[0]? =~ /queue/) {<br/><br/>&#160;&#160;&#160; @mailq = split(/n/,`postqueue -p`); @line = split(' ',$mailq[$#mailq]?); print $line[4]?; print $mailq;<br/><br/>}<br/><br/>untie %foo;<br/></pre><p>Now we can run "mailstats.pl sent" for example and get the number of messages that postfix has sent:</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><pre># ./mailstats.pl sent<br/>24428</pre><h2>Net-SNMP Configuration</h2><p>Now that we have a way to extract this data out of the stats.db&#160; database, we need to make it available to net-snmp so ZenOSS can grab it. To do this, we will use the "extend" function from net-snmp. Add the following (or something similar) to your snmpd.conf:</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><pre># Let's pipe postfix stats to net-snmp<br/>extend postfixSent /usr/local/bin/mailstats.pl sent<br/>extend postfixReceived /usr/local/bin/mailstats.pl received<br/>extend postfixQueue /usr/local/bin/mailstats.pl queue<br/>extend postfixBounced /usr/local/bin/mailstats.pl bounced<br/>extend postfixRejected /usr/local/bin/mailstats.pl rejected </pre><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p>After restarting snmpd, you should be able to retreive this stats via snmpwalk:</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><pre># snmpwalk -On -v2c -c&#160;&#160; .1 | grep postfix<br/>...<br/>NET-SNMP-EXTEND-MIB::nsExtendOutputFull."postfixSent" = STRING: 24492<br/>NET-SNMP-EXTEND-MIB::nsExtendOutputFull."postfixQueue" = STRING: 49<br/>NET-SNMP-EXTEND-MIB::nsExtendOutputFull."postfixBounced" = STRING: 22<br/>NET-SNMP-EXTEND-MIB::nsExtendOutputFull."postfixReceived" = STRING: 18353<br/>NET-SNMP-EXTEND-MIB::nsExtendOutputFull."postfixRejected" = STRING:<br/>... </pre><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p>To get their OID (make sure you escape the "'s with backslashes):</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><pre># snmpwalk -On -v2c -c&#160;&#160; NET-SNMP-EXTEND-MIB::nsExtendOutputFull.\"postfixSent\"<br/>.1.3.6.1.4.1.8072.1.3.2.3.1.2.11.112.111.115.116.102.105.120.83.101.110.116 = STRING: 24516 </pre><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p>This is the OID that you will add as a data source in ZenOSS<a class="jive-link-external-small" href="http://www.zenoss.com/community/wiki/user-contributed/ExtendingNetSNMPToAllowZenOSSToMonitorPostfix/createform?page=ZenOSS">?</a> to&#160; collected Postfix Sent Messages. Repeat this previous step for all 5&#160; datasources.</p><h2>ZenOSS Configuration</h2><p>Now we just need to configure ZenOSS. This will encompass creating a new template, defining datasources, defining a threshold and defining two graphs to display our data. By default, ZenOSS polls SNMP every 5&#160; minutes -- this is why our message stats are "per 5 minutes."</p><ol><li>Create a new template. Browse to /Devices/Server, click the Templates tab, click the dropdown and select "Add Template." Enter "Postfix" for the tempate name.</li><li>Add data sources using the OID's that you found earlier. We will add four datasources. Here are the OID's that I used in my environment. You should be able to SNMPWALK all of these OID's from your ZenOSS<a class="jive-link-external-small" href="http://www.zenoss.com/community/wiki/user-contributed/ExtendingNetSNMPToAllowZenOSSToMonitorPostfix/createform?page=ZenOSS">?</a> machine:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <ol><li>postfixBounced -&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1.3.6.1.4.1.8072.1.3.2.3.1.1.14.112.111.115.116.102.105.120.66.111.117.110.99.101.100 (Type: COUNTER)</li><li>postfixQueue&#160;&#160; -&#160;&#160;&#160;&#160; 1.3.6.1.4.1.8072.1.3.2.3.1.1.12.112.111.115.116.102.105.120.81.117.101.117.101 (Type: GAUGE) </li><li>postfixReceived -&#160; 1.3.6.1.4.1.8072.1.3.2.3.1.1.15.112.111.115.116.102.105.120.82.101.99.101.105.118.101.100&#160; (Type: COUNTER) </li><li>postfixSent -&#160;&#160;&#160;&#160;&#160; 1.3.6.1.4.1.8072.1.3.2.3.1.1.11.112.111.115.116.102.105.120.83.101.110.116 (Type: COUNTER) </li><li>postfixRejected -&#160;&#160;&#160;&#160; 1.3.6.1.4.1.8072.1.3.2.3.1.1.15.112.111.115.116.102.105.120.82.101.106.101.99.116.101.100 (Type: COUNTER) </li></ol> </li><li>Add a threshold.&#160; I added a threshold for postfixQueue to alert me if postfixQueue exceeds 200. </li><li>Define two graphs:&#160;&#160;&#160;&#160;&#160; <ol><li>Name: Postfix Messages. Add four graph points - received, sent, bounced, rejected. The RPN for all of these graph points MUST be "300,*" I used "%3.0lf" for my "format" for all of these points as well. The "Units" should be "messages/5min" </li><li>Name: Postfix Queue. Add one graph point - queue. RPN should be default, graph point format should be "%3.0lf" and unit should be "messages" You can also add your threshold to this graph if you would like. </li></ol> </li></ol><p>To use your newly created template, you will need to bind it to a device or device class using the Templates -&gt; Bind Templates option. After the template is bound, you should now be collecting postfix data. Check the performance tab of a device and you should see two new graphs. Note that the graphs will not be viewable immediatly -- give it at least 10 minutes.</p><p><a href="../servlet/JiveServlet/showImage/102-2477-2-1061/postfix-messages.jpg"><img alt="postfix-messages.jpg" class="jive-image-thumbnail jive-image" height="145" onclick="" src="../servlet/JiveServlet/downloadImage/102-2477-2-1061/450-145/postfix-messages.jpg" width="450"/></a></p><p><a href="../servlet/JiveServlet/showImage/102-2477-2-1062/postfix-queue.jpg"><img alt="postfix-queue.jpg" class="jive-image-thumbnail jive-image" height="142" onclick="" src="../servlet/JiveServlet/downloadImage/102-2477-2-1062/450-142/postfix-queue.jpg" width="450"/></a></p><p>I hope that this information is useful. Remember that you can use the net-snmp "extend" functionality to present a number of interesting metrics to SNMP. I use this same method for providing BIND stats to ZenOSS via SNMP.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">&#160;</p><p><em><strong>Josh Baird</strong></em> (jb @ irc.freenode.net / jbaird at <a class="jive-link-external-small" href="http://forums.zenoss.com/">http://forums.zenoss.com/</a>)</p></div><!-- [DocumentBodyEnd:881ef5f0-f988-4118-904a-2cabad597e43] -->

<!-- BEGIN attachments -->
<!-- END attachments -->
    </div>
    <div class="jive-content-footer clearfix">


    <!-- BEGIN content details -->
        <span class="jive-content-footer-item jive-content-footer-acclaim">

<div id="acclaim-container-102-2477-" class="acclaim-container">
    <div id="jive-acclaim-like-container-102-2477-" data-uniqueKey="102-2477-" data-ratingType="like" data-hasVoted="false" data-likes="0" class="acclaim-like-container">
         <span class="jive-icon-sml jive-icon-like"></span>Like
         (<a href="DOC-2477.html#" id="jive-acclaim-likedlink-102-2477-"  class=" jive-acclaim-likedlink">0</a>)
    </div>
</div>        </span>

     
        <span class="jive-content-footer-item">
            29403&nbsp;Views
        </span>

        



    <!-- BEGIN view/add/edit tags -->
    <span class="jive-content-footer-item jive-content-footer-tags">
    </span>
    <!-- END view/add/edit tags -->
<!-- END content -->

    </div>
</div>
<!-- END document -->





    
    <script>
    </script>






    <link rel="stylesheet" type="text/css" href="../4.5.6/styles/tiny_mce3/plugins/inlinepopups/skins/clearlooks2/window.css" />




    




        <a name="comments"></a>

        <!-- BEGIN tabs -->
        <div class="jive-body-tabbar">

                <span id="jive-comments-tab" class="jive-body-tab jive-body-tabcurrent">
                    <strong class="font-color-normal">
                        Comments (<span id="jive-comments-count">2</span>)
                    </strong>
                </span>

        </div>
        <!-- END tabs -->

            <div class="jive-box clearfix" id="jive-comments" ></div>

        <div style="display:none;" id="jive-comment-post-block">
            <form method="post" action="javascript:void(0);" name="jive-comment-post-form">

                <p class="jive-error-text" id="jive-comment-error" style="display:none"></p>

                    <div class="jive-comment-post-anonymous">
                        <div>
                            <input id="comment-author" name="commentGuestName" />
                            <label for="comment-author">Name</label>
                        </div>
                        <div>
                            <input id="comment-email" name="commentGuestEmail"  />
                            <label for="comment-email">Email Address</label>
                        </div>
                        <div>
                            <input id="comment-url" name="commentGuestUrl" />
                            <label for="comment-url">Website Address</label>
                        </div>
                    </div>

                <div>
                    <textarea name="commentBody" id="wysiwygtext" rows="10" class="jive-comment-textarea"></textarea>
                </div>

                <div style="display:none;" id="jive-blog-comment-preview" class="jive-blog-comment-preview"></div>


                <div class="jive-form-buttons">
                    <input type="submit" name="post" value="Add Comment" />
                    <input type="button" name="cancel" value="Cancel" />
                </div>

            </form>
        </div>

        <div style="display:none;"  id="jive-comment-edit-block">
            <form method="post" action="javascript:void(0);" name="jive-comment-edit-form">
                <p class="jive-error-text" id="jive-comment-error" style="display:none"></p>
                <div class="jive-comment-post-anonymous">
                    <div>
                        <input name="name" value="" />
                        <label for="name">Name
                            <span>(required)</span></label>
                    </div>
                    <div>
                        <input name="email" value="" />
                        <label for="email">Email Address
                            <span>(required, will not be published)</span></label>
                    </div>
                    <div>
                        <input name="url" value=""/>
                        <label for="url">Website Address</label>
                    </div>
                </div>
                <div>
                    <textarea name="commentBody" id="wysiwygtext" rows="10" class="jive-comment-textarea"><%= commentBody %></textarea>
                </div>

                <div style="display:none;" id="jive-blog-comment-preview" class="jive-blog-comment-preview"></div>

                <div class="jive-form-buttons">
                    <input type="button" name="post" value="Save" />
                    <input type="button" name="cancel" value="Cancel" />
                </div>

            </form>
        </div>




            </div>
        </div>
        <!-- END main body column -->


        <!-- BEGIN sidebar column -->
        <div id="jive-body-sidebarcol-container">

            <div id="jive-body-sidebarcol">


<div id="jive-action-sidebar" class="jive-sidebar jive-box jive-sidebar-actions jive-box-actions">


    <div class="jive-box-header">
        <h4 id="jive-action-sidebar-tab-header_document-actions-tab">Actions</h4>
    </div>
    <div id="jive-action-sidebar-body" class="jive-sidebar-body jive-sidebar-body-actions jive-box-body">

        <div id="jive-action-sidebar-tab-_document-actions-tab"
             class="jive-action-sidebar-tab-first"
 >



            <ul id="jive-action-sidebar-tab-list_document-actions-tab" class=" jive-icon-list">
















                <li id="jive-link-thread-print" style=""
                        ><a href="DOC-2477%3Fdecorator=print.html"
rel="nofollow"
onclick=""
title="">
<span class="jive-icon-med jive-icon-print-preview"></span>
View print preview
</a></li>



            </ul>
        </div> <!-- /#jive-action-sidebar-tab-_id -->
    </div>

</div>




    <!-- BEGIN sidebar box 'More Like This' -->

    <div class="jive-box jive-sidebar">
        <div class="jive-box-header jive-sidebar-header">
            <h4>More Like This</h4>
        </div>
        <div class="jive-box-body jive-sidebar-body jive-sidebar-body-morelikethis">
            <ul class="jive-icon-list" id="jive-more-like-this-102-2477">
                <li><span>Retrieving data ...</span></li>
            </ul>
        </div>
    </div>

    <!-- END sidebar box 'More Like This' -->

    
    

<!-- BEGIN sidebar box 'Incoming Links' -->
<div class="jive-box jive-sidebar">
    <div class="jive-box-header jive-sidebar-header">
        <h4>Incoming Links</h4>
    </div>
    <div class="jive-box-body jive-sidebar-body jive-sidebar-body-incominglinks">
        <ul class="jive-icon-list">
                        <li>
                            <a href="DOC-2445.html">
                            <span class="jive-icon-med jive-icon-document"></span>
                                Zenoss Users Forum FAQ
                            </a>
                        </li>
                        <li>
                            <a href="../message/49722.html#49722">
                            <span class="jive-icon-med jive-icon-discussion"></span>
                                Re: RE: Postfix ZenPack?
                            </a>
                        </li>
        </ul>
    </div>
</div>
<!-- END sidebar box 'Incoming Links' -->


        
        
        
        
        

<!-- BEGIN sidebar box 'User Content' -->
<div class="jive-box jive-sidebar">
    <div class="jive-box-header jive-sidebar-header">
        <h4>More by Noel Brockett</h4>
    </div>
    <div class="jive-box-body jive-sidebar-body jive-sidebar-body-usercontent">
        <ul class="jive-icon-list">
                    <li>
                        <a href="DOC-2494.html"
                        ><span class="jive-icon-med jive-icon-document"></span>Polling Interface Status</a>
                    </li>
                    <li>
                        <a href="DOC-2510.html"
                        ><span class="jive-icon-med jive-icon-document"></span>HowTo use LDAP/ActiveDirectory for Authentication and Authorization</a>
                    </li>
                    <li>
                        <a href="DOC-2496.html"
                        ><span class="jive-icon-med jive-icon-document"></span>How to install distributed collectors</a>
                    </li>
                    <li>
                        <a href="DOC-2476.html"
                        ><span class="jive-icon-med jive-icon-document"></span>Send Events</a>
                    </li>
                    <li>
                        <a href="DOC-2509.html"
                        ><span class="jive-icon-med jive-icon-document"></span>Zenoss Plugins</a>
                    </li>
        </ul>
        <div class="jive-sidebar-viewall">
            <a href="../people/nbrockett.html" class="font-color-meta j-link-viewall"><strong>View Noel Brockett's profile</strong></a>
        </div>
    </div>
</div>
<!-- END sidebar box 'User Content' -->


            </div>

        </div>
        <!-- END sidebar column -->


    </div>



        </div>

<div class="clear"></div>
        </div>
        <!-- MAIN CONTENT END -->
     <!-- END CONTENT -->

</div>
<!-- END MIDDLE CONTENT -->

<!-- START FOOTER -->
<div id="footer">
 <table cellpadding="0" cellspacing="0" border="0">
   <tr valign="top">
      <td rowspan="2" style="padding-left:10px;padding-right:10px;">
        <ul id="socialmedia">
        <li><a href="http://feeds.feedburner.com/ZenossBlog" class="rss" target="_blank"><span>rss</span></a></li>
           <li><a href="http://twitter.com/zenoss" class="twitter" target="_blank"><span>twitter</span></a></li>
           <li><a href="http://slashdot.org/bookmark.pl" class="slashdot" target="_blank"><span>slashdot</span></a></li>
           <li><a href="http://www.reddit.com/" class="reddit" target="_blank"><span>reddit</span></a></li>
           <li><a href="http://delicious.com/save" class="del" target="_blank"><span>delicious</span></a></li>
           <li><a href="http://technorati.com/" class="tech" target="_blank"><span>technorati</span></a></li>
       </ul> 
     </td>
     <td rowspan="2" style="padding-left:10px;padding-right:10px;">
        <a href="http://twitter.com/zenoss" title="Follow us on Twitter">Follow Us On Twitter &raquo;</a>
       <ul id="twitter_update_list"> </ul>
     </td>
     <td rowspan="2" style="padding-right:10px;">
        <a href="../blogs/zenossblog.html" title="Latest from the Zenoss blog">Latest from the Zenoss Blog &raquo;</a>
       <script language="JavaScript" src="http://feed2js.org//feed2js.php?src=http%3A%2F%2Ffeeds.feedburner.com%2FZenossBlog%3Fformat%3Dxml&amp;num=3&amp;desc=85&amp;targ=y" type="text/javascript"></script>
       <noscript><a href="http://feed2js.org//feed2js.php?src=http%3A%2F%2Ffeeds.feedburner.com%2FZenossBlog%3Fformat%3Dxml&amp;num=3&amp;desc=85&amp;targ=y&amp;html=y">View RSS feed</a></noscript>
     </td>
     <td rowspan="2" valign="middle" style="padding-right:20px;">
        <img src="../themes/userbar-disabled/images/tableborder.png" alt="" />
     </td>
     <td>
        Community
       <ul class="sitemap">
        <li><a href="../index.jspa.html" title="Home">Home</a></li>
           <li><a href="community/documentation" title="Documentation">Documentation</a></li>
           <li><a href="community/developers" title="Code">Code</a></li> 
           <li><a href="community/zenpacks" title="ZenPacks">ZenPacks</a></li> 
           <li><a href="community/forums" title="Discussion">Discussion</a></li> 
           <li><a href="community/partners" title="Get Involved">Get Involved</a></li> 
           <li><a href="../people.1.html" title="Membership">Membership</a></li>
       </ul>
     </td>
     <td>
        Products
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/solution/overview" title="Overview">Overview</a></li>
                        <li><a href="http://www.zenoss.com/solution/virtualization-monitoring" title="Virtualization Monitoring">Virtualization Monitoring</a></li>
                        <li><a href="http://www.zenoss.com/solution/cloud-monitoring" title="Cloud Monitoring">Cloud Monitoring</a></li>
                        <li><a href="http://www.zenoss.com/solution/cisco-ucs-management" title="Cisco UCS Management">Cisco UCS Management</a></li>
                        <li><a href="http://www.zenoss.com/solution/server-monitoring" title="Server Monitoring">Server Monitoring</a></li>
                        <li><a href="http://www.zenoss.com/solution/network" title="Network Monitoring">Network Monitoring</a></li>
       </ul>
     </td>
     <td>
        Services
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/support/index" title="Support Overview">Overview</a></li>
                        <li><a href="http://www.zenoss.com/support/consulting" title="Consulting">Consulting</a></li>
                        <li><a href="http://www.zenoss.com/support/customer-support" title="Support">Customer Support</a></li>
                        <li><a href="http://www.zenoss.com/support/training" title="Training">Training</a></li>        
       </ul>
       Resources
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/resources/demo" title="Resources">Resource Center</a></li>
       </ul>
     </td>
     <td>
       Customers
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/customers/index" title="Customers Overview">Overview</a></li>
                        <li><a href="http://www.zenoss.com/customers/case-studies/case-studies" title="Case Studies">Case Studies</a></li>
                        <li><a href="http://www.zenoss.com/customers/by-industry" title="Case Studies">Customers by Industry</a></li>
                        <li><a href="http://www.zenoss.com/customers/industries/index" title="Industries"><span>Industries</span></a></li>
       </ul>


       Partners
       <ul class="sitemap">
            <li><a href="http://www.zenoss.com/partners/open-source-network-management-solutions" title="Current Partners">Current Partners</a></li>
            <li><a href="http://www.zenoss.com/partners/contact" title="Become a Partner">Become a Partner</a></li>
       </ul>
     </td>
     <td style="padding-right:0px;">
        About Us
       <ul class="sitemap">
        <li><a href="http://www.zenoss.com/about/index" title="Overview">Overview</a></li> 
           <li><a href="http://www.zenoss.com/about/awards" title="Awards">Awards</a></li> 
           <li><a href="http://www.zenoss.com/about/team" title="Team">Team</a></li> 
           <li><a href="http://www.zenoss.com/about/news" title="News">News</a></li> 
           <li><a href="http://www.zenoss.com/about/news/events" title="Events">Events</a></li> 
           <li><a href="http://www.zenoss.com/about/jobs" title="Careers">Careers</a></li> 
           <li><a href="http://www.zenoss.com/about/contact" title="Contact">Contact</a></li>
       </ul>
     </td>
   </tr>
   <tr valign="middle">
     <td align="right">
        <a href="http://sourceforge.net/projects/zenoss" target="_blank" title="SourceForge"><img width="120" height="30" alt="Get Zenoss Core - Enterprise IT Monitoring at SourceForge.net. Fast, secure and Free Open Source software downloads" src="http://sflogo.sourceforge.net/sflogo.php?group_id=163126&amp;type=11"></a>
     </td>
     <td align="right">
        <a href="../index.html" title="Monitored by Zenoss"><img src="../themes/userbar-disabled/images/logo-monitoredby_ZEN.png" alt="Monitored By Zenoss" /></a>
     </td>
      <td colspan="3" align="right" >
        <a href="../index.html" title="Zenoss Home"><img src="../themes/userbar-disabled/images/new-logo-zenoss-footer_ZEN.gif" /></a>
       <div id="copyright" class="right">Copyright &copy; 2005-2011 Zenoss, Inc.</div>
     </td>
   </tr>
   <tr valign="top">
     <td colspan="9" align="right">&nbsp;</td>
   </tr>
 </table>
</div>
<!-- END FOOTER -->

 <!-- BEGIN SCRIPTS --> 

   <!-- END -->

    <!-- TOP NAV DROP DOWN NAVIGATION - IE6 -->
   <!-- END DROP DOWN -->       

   <!-- TWITTER SCRIPTS -->

<!-- END GOOGLE ANALYTICS CODE -->

<!-- Pardot tracking code, async version -->
<!-- END Pardot tracking code, async version -->




<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-73372470-1','auto');ga('send','pageview');</script></body>
</html>

