<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>
        12.5 Create a Performance Collector - Open Source Network Monitoring and Systems Management
        
        
    </title>

    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /> 


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en-US" />
<meta name="keywords" content=""/>
<!-- 12.5 Create a Performance Collector -->
<meta property="og:image" content="servlet/JiveServlet/downloadImage/73-2574-13230/share-zenoss-logo.jpg" />

<link rel="search"
    href="../opensearch.xml"
    title="Zenoss Community"
    type="application/opensearchdescription+xml"/>


<link rel="shortcut icon" href="../themes/userbar-disabled/images/favicon.ico" />

    





    
      
      
     




    



    
    





    <link rel="stylesheet" href="../styles/jive-global.css" type="text/css" media="all" />
    <!-- <link rel="stylesheet" href="/styles/jive-icons-legacy.css" type="text/css" media="all" /> -->
    <link rel="stylesheet" href="../styles/jive-icons.css" type="text/css" media="all" />

    <link rel="stylesheet" href="../themes/userbar-disabled/styles/theme.css" type="text/css" media="all" />
    <link rel="stylesheet" href="../themes/userbar-disabled/styles/community.css" type="text/css" media="all" />
    <link rel="stylesheet" href="../themes/userbar-disabled/styles/sifr.css" type="text/css" media="all" />


    <!--[if IE 6]>
    <style type="text/css">
    /* hack for IE6's lack of alpha PNG support */
    * html #jive-wrapper .ie6png,
    * html #jive-wrapper #jive-global-header *.ie6png,
    * html #jive-wrapper #user-bar-wrapper *.ie6png,
    * html #jive-wrapper #jive-body *.ie6png,
    * html #jive-wrapper #jive-footer *.ie6png {
        background-image: expression(
        this.runtimeStyle.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src=" +
        (this.tagName=='IMG' ? this.src : this.currentStyle.backgroundImage.split('\"')[1]) + ")",
        this.runtimeStyle.backgroundImage = "none",
        this.src = "/images/transparent.png"
        );
        }
    </style>

    <link rel="stylesheet" href="/styles/jive-icons-ie.css" type="text/css" media="all" />
    <![endif]-->





    
    

	<link rel="stylesheet" href="../4.5.6/styles/jive-content.css" type="text/css" media="all" />

        <link rel="alternate" type="application/rss+xml"
            title="12.5 Create a Performance Collector Version History Feed"
            href="community/feeds/document-history/DOC-3168" />

        <link rel="alternate" type="application/rss+xml"
            title="12.5 Create a Performance Collector Comments Feed"
            href="community/feeds/document-comments/DOC-3168" />

    
        




    <!-- BEGIN action bar, only for non-binary documents -->

    

    <!-- END action bar -->




    <style type="text/css">/* Rating bar on documents */
.jive-content .jive-content-header .jive-content-rating {margin-bottom: 3px;}
.j-rating { padding: 0 10px; }
.jive-content-avgrating {height: 53px;}
/* END Rating bar on documents */

/* Userbar */
#jive-userbar-right {right: 50px;}
/* END Userbar */

/* Download links page */
table.download-links-table {background-color: #ffffff; width: 100%;}
table.download-links-table tbody td { text-align: center; vertical-align: middle;}
table.download-links-table thead th {text-align: center;}
table.download-links-table td, table.download-links-table th {border: 1px solid #EEEEEE !important;}

/* Provides indentation for official doc ToC items */
div.toc dl dt {margin-left: 20px;}
div.toc dl dd dl dt {margin-left: 40px;}
div.toc dl dd dl dd dl dt {margin-left: 60px;}
div.toc dl dd dl dd dl dd dl dt {margin-left: 80px;}
div.toc dl dd dl dd dl dd dl dd dl dt {margin-left: 100px;}
/* END docs items */


/* Blog posts */
div.social-button-spacer {height: 10px;}

div#social-button-cont {
margin-right:10px; 
padding:5px; 
text-align: center; 
float: right;
}

div#comment-indicator {
    float: left;
    left: 12px;
    right: inherit;
    top: 55px;
}

div#comment-indicator div.jive-reply {margin-left: 0px;}

.jive-blog-post-subject {padding-bottom: 0px;}
/* END Blog posts */


/* Community download survey */
form#core-usage-survey label.aligned {float: left; width: 120px;}
form#core-usage-survey span.required_field {color: red;}
form#core-usage-survey label.survey-small-label {display:inline;}
form#core-usage-survey div.survey-checkbox-set {width:82%;}
form#core-usage-survey div.border {border:1px solid #ACACAC; padding:5px;}

form#core-usage-survey label.survey-resource_type {font-style:italic;}
form#core-usage-survey label {
color:#333333;
display:block;
font-size:12px;
font-weight:bold;
}
/* END Community download survey */

</style>
    <style type="text/css">/* custom-css-container */</style>


</head>
<body class="jive-body-content jive-body-content-document" >


<a href="DOC-3168.html#jive-body" class="jive-skip-nav">Skip navigation</a>

    <div id="jive-compliance" class=""style="display:none">
        <span class="jive-icon-med "></span>
        
    </div>

    <div id="jive-wrapper" class="clearfix">

    <!-- Load search for guests -->

    <div id="jive-userbar-search">
    <form action="search.jspa" method="get" id="jive-userbar-search-form">
        <input type="hidden" name="peopleEnabled" value="true"/>

        <input type="hidden" name="userID"/>
        <input type="hidden" name="containerType"/>
        <input type="hidden" name="container"/>
        <input type="hidden" name="spotlight" value="false"/>
        <label for="jive-query"
               class="j-508-label">Search for:</label>
        <input type="text" id="jive-query" name="q" value="" accesskey="4" class="searchbar jive-userbar-search-field"
               autocomplete="off"/>
    </form>

    <div id="jive-spotlight-search-container"></div>
</div>

    <!-- END anon search -->

<!-- SKIP NAV FOR ACCESSIBILITY -->
<a href="DOC-3168.html#skipnav"></a>
<!-- END -->

<div id="header">

    <!-- START TOP NAVIGATION -->
    <div id="navcontainer">
        <table cellpadding="0" cellspacing="0" width="100%" border="0">
          <tr valign="bottom">
            <td rowspan="2">
                <a href="../index.html" title="Zenoss Open Source IT Management"><img src="../themes/userbar-disabled/images/zenoss-logo-reversed-web.png" style="width:254px; margin: 0 0px 25px;" alt="Zenoss Open Enterprise Management" /></a>
            </td>
            <td height="45" colspan="2">
                <div id="zenoss-panel">
                    <div style="width: 200px;" id="cpanel-lt"></div>
                    <ul id="subnav-rt" class="png_fix">
                        <li><a href="http://www.zenoss.com/" title="Zenoss.Inc Home" class="none">Zenoss, Inc.</a></li>
                        <!--<li><a href="/community/feedback" title="Feedback" class="none">Feedback</a></li>-->
                        <!--<li><a href="http://www.zenoss.com/support" title="Support" class="none">Support</a></li>-->
                    </ul>
                </div>
            </td>
          </tr>
          <tr valign="middle">
            <td colspan="2" height="80">
                <ul id="navlist">
                    <li><a href="community/documentation" title="DOCS" class="nav1"><span>DOCS</span></a></li>
                    <li><a href="community/forums" title="FORUMS" class="nav2"><span>FORUMS</span></a></li>        
                    <!--<li><a href="/community/zenpacks" title="ZENPACKS" class="nav3"><span>ZENPACKS</span></a></li>-->
                    <li><a href="http://wiki.zenoss.org/Category:ZenPacks" title="ZENPACKS" class="nav3"><span>ZENPACKS</span></a></li>        
                    <li><a href="community/partners" title="PARTNERS" class="nav4"><span>PARTNERS</span></a></li>      
                    <li><a href="community/about" title="ABOUT" class="nav4"><span>ABOUT</span></a></li>   
                    <li><a href="../blogs/zenossblog.html" title="BLOG" class="nav5"><span>BLOG</span></a></li>
                    <li><a href="community/testing" title="TESTING" class="nav5"><span>TESTING</span></a></li> 
                    <li><a href="community/developers" title="DEVELOPERS" class="nav6"><span>DEVELOPMENT</span></a></li>
                    <li><a href="../community/download.html" title="DOWNLOADS" class="nav7 png_fix"><span>DOWNLOAD</span></a></li>
                </ul>
            </td>
          </tr>
        </table>
    </div>
    <!-- END TOP NAV -->

</div>

<!-- START MID COL -->
<div id="middle">

    <!-- SKIPNAV ADDED FOR ACCESSIBILITY -->
    <a name="skipnav"></a>
    <!-- SKIPNAV END -->
        
      <!-- START CONTENT -->
      
        <!-- MAIN CONTENT START -->
        <!-- CHANGE CLASS ACCORDING TO SUB SECTION FOR PROPER TOP BANNER -->


        <div id="subcontent">




<!-- BEGIN user bar -->
<div id="user-bar-wrapper">
    <div id="jive-userbar">
<div id="jive-userbar-login">
    <form action="https://community.zenoss.org/cs_login"
          method="post" name="loginform" autocomplete="off">
        
        

        <span class="jive-userbar-login-welcome" id="jiveLoginWelcome">
            <span class="jive-userbar-login-guest">
            Welcome, Guest
            </span>

            <span class="jive-userbar-login-loginlink">
                <a href="DOC-3168.html#" onClick="jivetoggleLogin(); return false;">Login</a>
            </span>

            <span class="jive-userbar-login-new">
                <a href="../login!input.jspa%3FregisterOnly=true.html">Register</a>
            </span>
        </span>

        <span class="jive-userbar-login-form" id="jiveLoginForm" style="display: none;">

            <span class="jive-userbar-login-username">
                <label for="login-username">
Username:                </label>
                <a href="docs/forgot-username!input.jspa" title="I forgot my username ">(?)</a>
                <input type="text" name="username" size="20" maxlength="150" value="" tabindex="1"
                               id="login-username" />
            </span>

            <span class="jive-userbar-login-password">
                <label for="login-password">
Password:                </label>
                <a href="docs/emailPasswordToken!input.jspa" title="I forgot my password ">(?)</a>
                <input type="password" name="password" size="20" maxlength="150" value="" tabindex="2"
                               id="login-password" />
            </span>

            <span class="jive-userbar-login-auto">
                <input type="checkbox" name="autoLogin" id="login-auto" value="true" tabindex="3" />
                <label for="login-auto">Remember Me</label>
            </span>

            <span class="jive-userbar-login-submit">
                <input type="submit" name="login" value="Login" tabindex="4"
                       class="jive-login-button" />
                <input type="reset" name="doCancel" value="Cancel" tabindex="5"
                               class="jive-cancel-button" onclick="jivetoggleLogin();" />
            </span>
        </span>

    </form>
</div>        <div id="jive-userbar-right">

    <div id="jive-userbar-search">
    <form action="search.jspa" method="get" id="jive-userbar-search-form">
        <input type="hidden" name="peopleEnabled" value="true"/>

        <input type="hidden" name="userID"/>
        <input type="hidden" name="containerType"/>
        <input type="hidden" name="container"/>
        <input type="hidden" name="spotlight" value="false"/>
        <label for="jive-query"
               class="j-508-label">Search for:</label>
        <input type="text" id="jive-query" name="q" value="" accesskey="4" class="searchbar jive-userbar-search-field"
               autocomplete="off"/>
    </form>

    <div id="jive-spotlight-search-container"></div>
</div>

        </div>
    </div>

</div>
<!-- END user bar -->

            <div id="jive-body">

<!-- BEGIN breadcrumb -->
<div id="jive-breadcrumb">

    <span>
                <a href="../index.jspa.html">
            Zenoss Community</a> &gt; 
                <a href="community/documentation">
            Documentation</a> &gt; 
                <a href="community/documentation/official_documentation">
            Zenoss Core Product Documentation</a> &gt; 
                <a href="community/documentation/official_documentation/zenoss-dev-guide">
            Zenoss Developer's Guide</a> &gt; 
                <a href="../community/documentation/official_documentation/zenoss-dev-guide/2.4.2">
            2.4.2</a> &gt; 

        <a class='jive-breadcrumb-last' href="../community/documentation/official_documentation/zenoss-dev-guide/2.4.2%3Fview=documents">Documents</a></span>
</div>
<!-- END breadcrumb -->

            

    <form id="documentRestoreForm" method="post" action='docs/DOC-3168/restore'>
        <input type="hidden" name="version" value="1" />
        <input type="hidden" name="jive.token.name" value="document.restore.DOC-3168"/>
        <input type="hidden" name="document.restore.DOC-3168" value="1394830673097-7PP03HVPMXW6BMB1C8EJCUMMGJG6LBS8"/>
    </form>

    <form id="documentDeleteForm" method="post" action='docs/DOC-3168/delete'>
        <input type="hidden" name="jive.token.name" value="document.delete.DOC-3168"/>
        <input type="hidden" name="document.delete.DOC-3168" value="1394830673102-KQ5JGZ7C02VDJ1TTXPNW41CRXXNID07C"/>
    </form>

    <form id="documentPublishForm" method="post" action='doc-publish.jspa'>
        <input type="hidden" name="jive.token.name" value="document.publish.DOC-3168"/>
        <input type="hidden" name="document.publish.DOC-3168" value="1394830673107-KSX8Y0ESE6QNQD6H6QT35I3XCPMFD5AI"/>
        <input type="hidden" name="document" value="DOC-3168" />
    </form>


    <!-- BEGIN header & intro  -->
    <div id="jive-body-intro">
        <div id="jive-body-intro-content">
            
            <a href="../community/documentation/official_documentation/zenoss-dev-guide/2.4.2%3Fview=documents"><span class="jive-icon-sml jive-icon-arrow-generic-up"></span>
                    Up to Documents in 2.4.2
            </a>

        </div>
    </div>
    <!-- END header & intro -->

    <!-- BEGIN main body -->
    <div id="jive-body-main">

        <!-- BEGIN main body column -->
        <div id="jive-body-maincol-container">

            <div id="jive-body-maincol">


                <div id="thread.watch.notify" class="jive-info-box" style="display:none"></div>

                <div id="content-featured-notify" class="jive-info-box" style="display:none"></div>








<!-- BEGIN document -->
<div class="jive-content clearfix">
    <div class="jive-content-header clearfix">
        <div class="jive-wiki-post-moderating jive-content-header-moderating">
            <span class="jive-icon-med jive-icon-moderation"></span>Currently Being Moderated
        </div>
        <div class="jive-content-title">
            <h2><span class="jive-icon-big jive-icon-document"></span>12.5 Create a Performance Collector</h2>
        </div>
        <div class="jive-content-header-version">
            VERSION 1&nbsp;


        </div>
        <div class="jive-content-header-details">

Created on: Sep 14, 2009 11:46 AM by
<a href="../people/zenoss_api.html"
data-externalId=""
data-username="zenoss_api"
data-avatarId="-1"
id="jive-692632882057205466413"
onmouseover="var presence = null; quickuserprofile.getUserProfileTooltip( 6926, presence );"
onmouseout="quickuserprofile.cancelTooltip();"
class="jiveTT-hover-user jive-username-link"
>Zenoss API</a>            <span>-</span>
Last Modified:&nbsp;
Sep 14, 2009 11:46 AM
by <a href="../people/zenoss_api.html"
data-externalId=""
data-username="zenoss_api"
data-avatarId="-1"
id="jive-692632882057206112271"
onmouseover="var presence = null; quickuserprofile.getUserProfileTooltip( 6926, presence );"
onmouseout="quickuserprofile.cancelTooltip();"
class="jiveTT-hover-user jive-username-link"
>Zenoss API</a>        </div>

        <div class="jive-content-rating clearfix" data-guid="M80SR98IT0S1T4YSBUAGSODIOHH40EX6">

<script type='text/javascript'>
    $j(document).ready(function() {

        var i18n = {
            avgUserRatingTitlei18n : "Average User Rating",
            avgUserRatingLabeli18n : "Average User Rating",
            rateRatingLabel : "rating",
            myRatingLabel : "My Rating:",
            rateRatingsLabel : "ratings",
            ratingSavingText : "Saving...",
            rateSavedText : "Saved.",
            rateRatingSaved : "Rating Saved!",
            writeAReview : "Write a review",
            commentOnRating : "Comment on your rating",
            formSubmitPleaseWait:'Please Wait ...'
        };

        new jive.Rate(14, 2159, 102, 3168, 'doc', i18n, true, 'M80SR98IT0S1T4YSBUAGSODIOHH40EX6');
    });

</script>

        </div>
    </div>

    <div class="jive-content-body">


<!-- [DocumentBodyStart:20f35ec7-43d3-4405-9d14-d4648b0cf574] --><div class="jive-rendered-content"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3" style=";">5.&#160;Create a Performance Collector</th></tr><tr><td align="left" style=";" width="20%"><a class="jive-link-external-small" href="zenoss-dev-guide/2.4.2/ch12s04.html">Prev</a>&#160;</td><th align="center" style=";" width="60%">Chapter&#160;12.&#160;Adding a Device Type</th><td align="right" style=";" width="20%">&#160;<a class="jive-link-external-small" href="zenoss-dev-guide/2.4.2/ch12s06.html">Next</a></td></tr></table><hr/></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both;"><a class="jive-link-anchor-small" name="d4e2808">#</a>5.&#160;Create a Performance Collector</h2></div></div></div><p>A performance data collector gathers the current statistics of items such as the amount of space used in a file system. The data can be collected using either a script or an SNMP command. For our <code class="classname">Filesystem</code> data, we must create a new data collector called <code class="classname">Filesystem</code> (this is a special name) that will return a property called <span class="property">usedBlocks</span> (another special name).</p><p>If your operating system's MIB provides a <span class="property">usedBlocks</span> (or something named like that) value, then we can make use of existing Zenoss infrastructure and just collect that data using SNMP. Otherwise, you need to create a script to take the total size of the filesystem (<span class="property">totalBlocks</span>) and subtract the <span class="property">freeBlocks</span> value. Unfortunately, AIX only provides <span class="property">freeBlocks</span>, so we need to create a command.</p><p>With the Zenoss 2.4 release, we can also create a command parser to gather our performance information. This new functionality allows you to write simple code to gather performance data and graph the results.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a class="jive-link-anchor-small" name="d4e2820">#</a>5.1.&#160;Performance Data Collector Code</h3></div></div></div><p>Multiple collectors for different components of a system can be created, or one huge collectors for everything can be created. Smaller collectors are preferred for maintenance reasons. The following collector is for calculating file system free space, and would live in the <code class="filename">libexec/</code> directory of your ZenPack.</p><pre class="programlisting">#!/usr/bin/env python

"""Gather used disk space statistics for AIX"""

import sys
import re
from subprocess import *

base_fs_table_oid= "1.3.6.1.4.1.2.6.191.6.2.1"

def process_disk_stats( device, community, totalBlocks_oid, freeBlocks_oid ):
&#160;&#160;&#160; """Gather OID info and sanitize it"""

&#160;&#160;&#160; cmd= "snmpwalk -v1 -c %s -On %s %s %s" % ( community, device, \
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; totalBlocks_oid, freeBlocks_oid )
&#160;&#160;&#160; proc= Popen( cmd, shell=True, stdout=PIPE, stderr=PIPE )

&#160;&#160;&#160; #
&#160;&#160;&#160; # Check to make sure that we don't have any hangups in
&#160;&#160;&#160; # executing our smidump
&#160;&#160;&#160; #
&#160;&#160;&#160; if not proc.stdout:
&#160;&#160;&#160;&#160;&#160;&#160;&#160; print "Couldn't open pipe to stdout for %s" % cmd
&#160;&#160;&#160;&#160;&#160;&#160;&#160; return

&#160;&#160;&#160; if not proc.stderr:
&#160;&#160;&#160;&#160;&#160;&#160;&#160; print "Couldn't open pipe to stderr for %s" % cmd
&#160;&#160;&#160;&#160;&#160;&#160;&#160; return

&#160;&#160;&#160; ( line1, line2 )= proc.stdout.readlines()
&#160;&#160;&#160; totalBlocks= line1.split()[-1]
&#160;&#160;&#160; freeBlocks= line2.split()[-1]
&#160;&#160;&#160; usedBlocks= totalBlocks - freeBlocks

&#160;&#160;&#160; return totalBlocks, freeBlocks, usedBlocks


if __name__ == "__main__":
&#160;&#160;&#160; if len(sys.argv) &lt; 4:
&#160;&#160;&#160;&#160;&#160;&#160;&#160; print "Need device, community and fs_index arguments!"
&#160;&#160;&#160;&#160;&#160;&#160;&#160; sys.exit(1)

&#160;&#160;&#160; (device, community, fs_index )= sys.argv[1:]

&#160;&#160;&#160; totalBlocks_oid= ".".join( base_fs_table_oid, 5, fs_index )
&#160;&#160;&#160; freeBlocks_oid= ".".join( base_fs_table_oid, 6, fs_index )

&#160;&#160;&#160; totalBlocks, freeBlocks, usedBlocks= process_disk_stats( device, \
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; community, totalBlocks_oid, freeBlocks_oid )
&#160;&#160;&#160; print "totalBlocks:%s freeBlocks:%s usedBlocks:%s" % ( totalBlocks, \
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; freeBlocks, usedBlocks )
&#160;&#160;&#160; sys.exit(0)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a class="jive-link-anchor-small" name="new_platform_command_parsers">#</a>5.2.&#160;Writing Your Own Command Parser</h3></div></div></div><p><span class="command"><strong>Zencommand</strong></span> may be used to execute commands on remote hosts using the SSH protocol. This provides secure and flexible performance monitoring for Unix-style systems such as AIX, Solaris, OS X (Darwin) and Linux servers.</p><p>When the remote host has commands that show data in a format already understood by <span class="command"><strong>Zencommand</strong></span> (such as Nagios or Cacti plugins), <span class="command"><strong>Zencommand</strong></span> can process the results and update the ZODB. However, if you are monitoring servers that have not had these commands installed, you need to extend <span class="command"><strong>Zencommand</strong></span> with new parsers to understand the results.</p><p>The basic data flow for <span class="command"><strong>Zencommand</strong></span> is this:</p><div class="orderedlist"><ol type="1"><li><p>A collector starts <span class="command"><strong>Zencommand</strong></span> with a collector name, like <code class="constant">localhost</code> or <code class="constant">collector2</code>.</p></li><li><p><span class="command"><strong>Zencommand</strong></span> contacts <span class="command"><strong>zenhub</strong></span> and loads the commands to be run against the devices for that configuration. The command configuration includes details such as "use SSH" to run the command on the remote box and credentials to allow access to the remote host. The command configuration also includes a specification for the parser to use on the data that is returned by the command.</p></li><li><p><span class="command"><strong>Zencommand</strong></span> runs the command on the remote host, and when the command finishes, a parser is created and the results are passed to the <code class="function">processResults()</code> method of the parser. The <code class="function">processResults()</code> method is passed the command configuration fetched from ZenHub, and an object into which parsed results will be placed. The parser is also used to copy any data needed by <span class="command"><strong>Zencommand</strong></span> during the parsing.</p></li><li><p><span class="command"><strong>Zencommand</strong></span> takes the returned Python dictionary from the parser and updates the ZODB.</p></li></ol></div><p>Consider the Unix <span class="command"><strong>df</strong></span> command. It can be used to determine free disk space on a device's file systems. Here's a typical output format from Linux:</p><pre class="screen">Filesystem&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1K-blocks&#160;&#160;&#160;&#160;&#160; Used Available Use% Mounted on
/dev/sda6&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 57669700&#160; 34162636&#160; 20577616&#160; 63% /
/dev/sda7&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 71133144&#160; 28824804&#160; 38694924&#160; 43% /home
/dev/mmcblk1&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3924476&#160;&#160;&#160;&#160;&#160;&#160; 536&#160;&#160; 3923940&#160;&#160; 1% /media/disk</pre><p>The Zenoss data modeler (<span class="command"><strong>zenmodeler</strong></span>) will have created components under this device for the file systems. The mapping of data to the component must use the mount point information. ZenHub must copy mount point information from the model data stored in the ZODB into the configuration for this command. To know what data may be needed for parsing, ZenHub creates the parser that will be used by Zencommand, and calls the <code class="function">dataForParser()</code> method. Remember, this happens in ZenHub, and not <span class="command"><strong>Zencommand</strong></span>, and it happens before any command is run.</p><p>The result of <code class="function">dataForParser()</code> is a Python dictionary that is stored as <code class="constant">data</code> in the command configuration passed to <span class="command"><strong>Zencommand</strong></span>. When the parser is invoked in Zencommand, it will have access to this information.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><div class="itemizedlist"><ul type="disc"><li><p>After the parser digests the results of running the command, it can produce performance information and events.</p></li><li><p>The result object is a simple Python class that contains two lists, one called <code class="constant">values</code> and the other called <code class="constant">events</code>.</p></li><li><p>The <code class="constant">events</code> item contains a dictionary of string to value mappings which are turned into events. <span class="command"><strong>Zencommand</strong></span> will update the event with the device name, but the rest of the fields (such as component, severity, etc) are up to the parser to fill in.</p></li><li><p>The <code class="constant">values</code> item is a list of two-element tuples. The first element is the data point, and the second is a value, which is a Python number or <code class="constant">None</code>. <code class="constant">None</code> is always ignored.</p></li><li><p>Every command run by <span class="command"><strong>Zencommand</strong></span> comes with a list of data points that correspond to that command. In our <span class="command"><strong>df</strong></span> example, the datapoints may include <code class="varname">percentUsed</code> and <code class="varname">blocksFree</code>, along with any thresholds or parser-specific data, such as mount point.</p></li><li><p>Thresholds will be tested by <span class="command"><strong>Zencommand</strong></span>, and threshold events automatically generated.</p></li><li><p>The command's exit code is available at parse time, too.</p></li></ul></div></div><p>Parsers will be available to Zenoss when they are placed in the <code class="filename">$ZENHOME/Products/ZenRRD/parsers</code> directory or in a ZenPack's <code class="filename">$ZENHOME/ZenPacks.<em class="replaceable"><code>pkg</code></em>.<em class="replaceable"><code>zpid</code></em>-<em class="replaceable"><code>version_id</code></em>-py2.4.egg/Zenpacks/<em class="replaceable"><code>pkg</code></em>/<em class="replaceable"><code>zpid</code></em>/parsers</code> directory. Each parser should be a sub-class of the <code class="classname">Products.ZenRRD.CommandParser.CommandParser</code> class.</p><p>A command like <span class="command"><strong>df</strong></span> is a very common case. Unix commands will often emit easily-parsed, line-oriented records. There are some useful subclasses of <code class="classname">CommandParser</code> that perform much of the parsing if you provide these parsers with the right details, such as regular expressions. They are:</p><div class="table"><a class="jive-link-anchor-small" name="d4e2905">#</a><p class="title"><strong>Table&#160;12.2.&#160;<code class="classname">CommandParser</code> Helper Parsers</strong></p><div class="table-contents"><table border="1" summary="CommandParser Helper Parsers"><colgroup><col width="25%"></col><col width="75%"></col></colgroup><thead><tr><th style="border:1px solid black;">Name</th><th style="border:1px solid black;">Description</th></tr></thead><tbody><tr><td style="border:1px solid black;"><code class="classname">componentScanner</code></td><td style="border:1px solid black;"><p>A regular expression that finds details about a component that can be used to map back to the component known to the Zenoss model. It must return a match named <code class="varname">component</code> using the Python regular expression syntax <code class="code">?P&lt;component&gt;</code> </p></td></tr><tr><td style="border:1px solid black;"><code class="classname">scanners</code></td><td style="border:1px solid black;"><p>An iterable list of regular expressions that will pull out numerical values from the output of the command.</p></td></tr><tr><td style="border:1px solid black;"><code class="classname">componentScanValue</code></td><td style="border:1px solid black;"><p>The data to be copied to the data point needed to match the component to the output results.</p></td></tr></tbody></table></div></div><br class="table-break"/><p>Let's examine what these values might be for our <span class="command"><strong>df</strong></span> command, and its example output.</p><div class="orderedlist"><ol type="1"><li><p>For the <code class="classname">componentScanner</code>, we want to find the mount-point data and extract it, so that we can match the Unix file separator ('/') to the component file system that has the id "_". We can use something like:</p><p><code class="filename">% (?P&lt;component&gt;/.*)$</code></p></li><li><p>For the <code class="classname">scanners</code>, we'll use a tuple of regular expressions to pull out the numerical values we want:</p><pre class="programlisting">( r' (?P&lt;availableBlocks&gt;\d+) +(?P&lt;percentUsed&gt;\d+)%' )</pre></li><li><p>For the <code class="classname">componentScanValue</code>, we'll specify <code class="constant">mount</code> so that the mount point information is copied to the command configuration by ZenHub and matched against the <code class="varname">component</code> value parsed by the <code class="classname">componentScanner</code> regular expression.</p></li></ol></div></div></div><div class="navfooter"><hr/><table summary="Navigation footer" width="100%"><tr><td align="left" style=";" width="40%"><a class="jive-link-external-small" href="zenoss-dev-guide/2.4.2/ch12s04.html">Prev</a>&#160;</td><td align="center" style=";" width="20%"><a class="jive-link-external-small" href="zenoss-dev-guide/2.4.2/ch12.html">Up</a></td><td align="right" style=";" width="40%">&#160;<a class="jive-link-external-small" href="zenoss-dev-guide/2.4.2/ch12s06.html">Next</a></td></tr><tr><td align="left" style=";" valign="top" width="40%">4.&#160;Create a Modeler&#160;</td><td align="center" style=";" width="20%"><a class="jive-link-external-small" href="zenoss-dev-guide/2.4.2/index.html">Home</a></td><td align="right" style=";" valign="top" width="40%">&#160;6.&#160;Create the Template</td></tr></table></div></div><!-- [DocumentBodyEnd:20f35ec7-43d3-4405-9d14-d4648b0cf574] -->

<!-- BEGIN attachments -->
<!-- END attachments -->
    </div>
    <div class="jive-content-footer clearfix">


    <!-- BEGIN content details -->
        <span class="jive-content-footer-item jive-content-footer-acclaim">

<div id="acclaim-container-102-3168-" class="acclaim-container">
    <div id="jive-acclaim-like-container-102-3168-" data-uniqueKey="102-3168-" data-ratingType="like" data-hasVoted="false" data-likes="0" class="acclaim-like-container">
         <span class="jive-icon-sml jive-icon-like"></span>Like
         (<a href="DOC-3168.html#" id="jive-acclaim-likedlink-102-3168-"  class=" jive-acclaim-likedlink">0</a>)
    </div>
</div>        </span>

     
        <span class="jive-content-footer-item">
            8684&nbsp;Views
        </span>

        



    <!-- BEGIN view/add/edit tags -->
    <span class="jive-content-footer-item jive-content-footer-tags">
    </span>
    <!-- END view/add/edit tags -->
<!-- END content -->

    </div>
</div>
<!-- END document -->





    
    <script>
    </script>






    <link rel="stylesheet" type="text/css" href="../4.5.6/styles/tiny_mce3/plugins/inlinepopups/skins/clearlooks2/window.css" />




    




        <a name="comments"></a>

        <!-- BEGIN tabs -->
        <div class="jive-body-tabbar">

                <span id="jive-comments-tab" class="jive-body-tab jive-body-tabcurrent">
                    <strong class="font-color-normal">
                        Comments (<span id="jive-comments-count">0</span>)
                    </strong>
                </span>

        </div>
        <!-- END tabs -->

            <div class="jive-box clearfix" id="jive-comments" ></div>

        <div style="display:none;" id="jive-comment-post-block">
            <form method="post" action="javascript:void(0);" name="jive-comment-post-form">

                <p class="jive-error-text" id="jive-comment-error" style="display:none"></p>

                    <div class="jive-comment-post-anonymous">
                        <div>
                            <input id="comment-author" name="commentGuestName" />
                            <label for="comment-author">Name</label>
                        </div>
                        <div>
                            <input id="comment-email" name="commentGuestEmail"  />
                            <label for="comment-email">Email Address</label>
                        </div>
                        <div>
                            <input id="comment-url" name="commentGuestUrl" />
                            <label for="comment-url">Website Address</label>
                        </div>
                    </div>

                <div>
                    <textarea name="commentBody" id="wysiwygtext" rows="10" class="jive-comment-textarea"></textarea>
                </div>

                <div style="display:none;" id="jive-blog-comment-preview" class="jive-blog-comment-preview"></div>


                <div class="jive-form-buttons">
                    <input type="submit" name="post" value="Add Comment" />
                    <input type="button" name="cancel" value="Cancel" />
                </div>

            </form>
        </div>

        <div style="display:none;"  id="jive-comment-edit-block">
            <form method="post" action="javascript:void(0);" name="jive-comment-edit-form">
                <p class="jive-error-text" id="jive-comment-error" style="display:none"></p>
                <div class="jive-comment-post-anonymous">
                    <div>
                        <input name="name" value="" />
                        <label for="name">Name
                            <span>(required)</span></label>
                    </div>
                    <div>
                        <input name="email" value="" />
                        <label for="email">Email Address
                            <span>(required, will not be published)</span></label>
                    </div>
                    <div>
                        <input name="url" value=""/>
                        <label for="url">Website Address</label>
                    </div>
                </div>
                <div>
                    <textarea name="commentBody" id="wysiwygtext" rows="10" class="jive-comment-textarea"><%= commentBody %></textarea>
                </div>

                <div style="display:none;" id="jive-blog-comment-preview" class="jive-blog-comment-preview"></div>

                <div class="jive-form-buttons">
                    <input type="button" name="post" value="Save" />
                    <input type="button" name="cancel" value="Cancel" />
                </div>

            </form>
        </div>




            </div>
        </div>
        <!-- END main body column -->


        <!-- BEGIN sidebar column -->
        <div id="jive-body-sidebarcol-container">

            <div id="jive-body-sidebarcol">


<div id="jive-action-sidebar" class="jive-sidebar jive-box jive-sidebar-actions jive-box-actions">


    <div class="jive-box-header">
        <h4 id="jive-action-sidebar-tab-header_document-actions-tab">Actions</h4>
    </div>
    <div id="jive-action-sidebar-body" class="jive-sidebar-body jive-sidebar-body-actions jive-box-body">

        <div id="jive-action-sidebar-tab-_document-actions-tab"
             class="jive-action-sidebar-tab-first"
 >



            <ul id="jive-action-sidebar-tab-list_document-actions-tab" class=" jive-icon-list">
















                <li id="jive-link-thread-print" style=""
                        ><a href="DOC-3168%3Fdecorator=print.html"
rel="nofollow"
onclick=""
title="">
<span class="jive-icon-med jive-icon-print-preview"></span>
View print preview
</a></li>



            </ul>
        </div> <!-- /#jive-action-sidebar-tab-_id -->
    </div>

</div>




    <!-- BEGIN sidebar box 'More Like This' -->

    <div class="jive-box jive-sidebar">
        <div class="jive-box-header jive-sidebar-header">
            <h4>More Like This</h4>
        </div>
        <div class="jive-box-body jive-sidebar-body jive-sidebar-body-morelikethis">
            <ul class="jive-icon-list" id="jive-more-like-this-102-3168">
                <li><span>Retrieving data ...</span></li>
            </ul>
        </div>
    </div>

    <!-- END sidebar box 'More Like This' -->

    
    

        
        
        
        
        

<!-- BEGIN sidebar box 'User Content' -->
<div class="jive-box jive-sidebar">
    <div class="jive-box-header jive-sidebar-header">
        <h4>More by Zenoss API</h4>
    </div>
    <div class="jive-box-body jive-sidebar-body jive-sidebar-body-usercontent">
        <ul class="jive-icon-list">
                    <li>
                        <a href="DOC-3211.html"
                        ><span class="jive-icon-med jive-icon-document"></span>2.5 Programming Documentation</a>
                    </li>
                    <li>
                        <a href="DOC-3157.html"
                        ><span class="jive-icon-med jive-icon-document"></span>3.3 ZenPack Structure and Contents</a>
                    </li>
                    <li>
                        <a href="DOC-3180.html"
                        ><span class="jive-icon-med jive-icon-document"></span>9.2 One-to-Many (1:N) Relationships</a>
                    </li>
                    <li>
                        <a href="DOC-3177.html"
                        ><span class="jive-icon-med jive-icon-document"></span>9.1 Add a ZenModel Relationship</a>
                    </li>
                    <li>
                        <a href="DOC-3184.html"
                        ><span class="jive-icon-med jive-icon-document"></span>Zenoss Developer's Guide for 2.4</a>
                    </li>
        </ul>
        <div class="jive-sidebar-viewall">
            <a href="../people/zenoss_api.html" class="font-color-meta j-link-viewall"><strong>View Zenoss API's profile</strong></a>
        </div>
    </div>
</div>
<!-- END sidebar box 'User Content' -->


            </div>

        </div>
        <!-- END sidebar column -->


    </div>



        </div>

<div class="clear"></div>
        </div>
        <!-- MAIN CONTENT END -->
     <!-- END CONTENT -->

</div>
<!-- END MIDDLE CONTENT -->

<!-- START FOOTER -->
<div id="footer">
 <table cellpadding="0" cellspacing="0" border="0">
   <tr valign="top">
      <td rowspan="2" style="padding-left:10px;padding-right:10px;">
        <ul id="socialmedia">
        <li><a href="http://feeds.feedburner.com/ZenossBlog" class="rss" target="_blank"><span>rss</span></a></li>
           <li><a href="http://twitter.com/zenoss" class="twitter" target="_blank"><span>twitter</span></a></li>
           <li><a href="http://slashdot.org/bookmark.pl" class="slashdot" target="_blank"><span>slashdot</span></a></li>
           <li><a href="http://www.reddit.com/" class="reddit" target="_blank"><span>reddit</span></a></li>
           <li><a href="http://delicious.com/save" class="del" target="_blank"><span>delicious</span></a></li>
           <li><a href="http://technorati.com/" class="tech" target="_blank"><span>technorati</span></a></li>
       </ul> 
     </td>
     <td rowspan="2" style="padding-left:10px;padding-right:10px;">
        <a href="http://twitter.com/zenoss" title="Follow us on Twitter">Follow Us On Twitter &raquo;</a>
       <ul id="twitter_update_list"> </ul>
     </td>
     <td rowspan="2" style="padding-right:10px;">
        <a href="../blogs/zenossblog.html" title="Latest from the Zenoss blog">Latest from the Zenoss Blog &raquo;</a>
       <script language="JavaScript" src="http://feed2js.org//feed2js.php?src=http%3A%2F%2Ffeeds.feedburner.com%2FZenossBlog%3Fformat%3Dxml&amp;num=3&amp;desc=85&amp;targ=y" type="text/javascript"></script>
       <noscript><a href="http://feed2js.org//feed2js.php?src=http%3A%2F%2Ffeeds.feedburner.com%2FZenossBlog%3Fformat%3Dxml&amp;num=3&amp;desc=85&amp;targ=y&amp;html=y">View RSS feed</a></noscript>
     </td>
     <td rowspan="2" valign="middle" style="padding-right:20px;">
        <img src="../themes/userbar-disabled/images/tableborder.png" alt="" />
     </td>
     <td>
        Community
       <ul class="sitemap">
        <li><a href="../index.jspa.html" title="Home">Home</a></li>
           <li><a href="community/documentation" title="Documentation">Documentation</a></li>
           <li><a href="community/developers" title="Code">Code</a></li> 
           <li><a href="community/zenpacks" title="ZenPacks">ZenPacks</a></li> 
           <li><a href="community/forums" title="Discussion">Discussion</a></li> 
           <li><a href="community/partners" title="Get Involved">Get Involved</a></li> 
           <li><a href="../people.1.html" title="Membership">Membership</a></li>
       </ul>
     </td>
     <td>
        Products
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/solution/overview" title="Overview">Overview</a></li>
                        <li><a href="http://www.zenoss.com/solution/virtualization-monitoring" title="Virtualization Monitoring">Virtualization Monitoring</a></li>
                        <li><a href="http://www.zenoss.com/solution/cloud-monitoring" title="Cloud Monitoring">Cloud Monitoring</a></li>
                        <li><a href="http://www.zenoss.com/solution/cisco-ucs-management" title="Cisco UCS Management">Cisco UCS Management</a></li>
                        <li><a href="http://www.zenoss.com/solution/server-monitoring" title="Server Monitoring">Server Monitoring</a></li>
                        <li><a href="http://www.zenoss.com/solution/network" title="Network Monitoring">Network Monitoring</a></li>
       </ul>
     </td>
     <td>
        Services
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/support/index" title="Support Overview">Overview</a></li>
                        <li><a href="http://www.zenoss.com/support/consulting" title="Consulting">Consulting</a></li>
                        <li><a href="http://www.zenoss.com/support/customer-support" title="Support">Customer Support</a></li>
                        <li><a href="http://www.zenoss.com/support/training" title="Training">Training</a></li>        
       </ul>
       Resources
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/resources/demo" title="Resources">Resource Center</a></li>
       </ul>
     </td>
     <td>
       Customers
       <ul class="sitemap">
                        <li><a href="http://www.zenoss.com/customers/index" title="Customers Overview">Overview</a></li>
                        <li><a href="http://www.zenoss.com/customers/case-studies/case-studies" title="Case Studies">Case Studies</a></li>
                        <li><a href="http://www.zenoss.com/customers/by-industry" title="Case Studies">Customers by Industry</a></li>
                        <li><a href="http://www.zenoss.com/customers/industries/index" title="Industries"><span>Industries</span></a></li>
       </ul>


       Partners
       <ul class="sitemap">
            <li><a href="http://www.zenoss.com/partners/open-source-network-management-solutions" title="Current Partners">Current Partners</a></li>
            <li><a href="http://www.zenoss.com/partners/contact" title="Become a Partner">Become a Partner</a></li>
       </ul>
     </td>
     <td style="padding-right:0px;">
        About Us
       <ul class="sitemap">
        <li><a href="http://www.zenoss.com/about/index" title="Overview">Overview</a></li> 
           <li><a href="http://www.zenoss.com/about/awards" title="Awards">Awards</a></li> 
           <li><a href="http://www.zenoss.com/about/team" title="Team">Team</a></li> 
           <li><a href="http://www.zenoss.com/about/news" title="News">News</a></li> 
           <li><a href="http://www.zenoss.com/about/news/events" title="Events">Events</a></li> 
           <li><a href="http://www.zenoss.com/about/jobs" title="Careers">Careers</a></li> 
           <li><a href="http://www.zenoss.com/about/contact" title="Contact">Contact</a></li>
       </ul>
     </td>
   </tr>
   <tr valign="middle">
     <td align="right">
        <a href="http://sourceforge.net/projects/zenoss" target="_blank" title="SourceForge"><img width="120" height="30" alt="Get Zenoss Core - Enterprise IT Monitoring at SourceForge.net. Fast, secure and Free Open Source software downloads" src="http://sflogo.sourceforge.net/sflogo.php?group_id=163126&amp;type=11"></a>
     </td>
     <td align="right">
        <a href="../index.html" title="Monitored by Zenoss"><img src="../themes/userbar-disabled/images/logo-monitoredby_ZEN.png" alt="Monitored By Zenoss" /></a>
     </td>
      <td colspan="3" align="right" >
        <a href="../index.html" title="Zenoss Home"><img src="../themes/userbar-disabled/images/new-logo-zenoss-footer_ZEN.gif" /></a>
       <div id="copyright" class="right">Copyright &copy; 2005-2011 Zenoss, Inc.</div>
     </td>
   </tr>
   <tr valign="top">
     <td colspan="9" align="right">&nbsp;</td>
   </tr>
 </table>
</div>
<!-- END FOOTER -->

 <!-- BEGIN SCRIPTS --> 

   <!-- END -->

    <!-- TOP NAV DROP DOWN NAVIGATION - IE6 -->
   <!-- END DROP DOWN -->       

   <!-- TWITTER SCRIPTS -->

<!-- END GOOGLE ANALYTICS CODE -->

<!-- Pardot tracking code, async version -->
<!-- END Pardot tracking code, async version -->




<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-73372470-1','auto');ga('send','pageview');</script></body>
</html>

